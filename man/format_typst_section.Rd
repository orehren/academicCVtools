% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/format_typst_section.R
\name{format_typst_section}
\alias{format_typst_section}
\title{Format CV section data into a Typst string}
\usage{
format_typst_section(
  data,
  typst_func,
  combine_cols = NULL,
  combine_as = "details",
  combine_sep = "\\\\n",
  combine_prefix = "- ",
  exclude_cols = NULL,
  na_action = c("omit", "keep", "string")
)
}
\arguments{
\item{data}{A data frame or tibble where each row is a CV entry and columns
are fields. Typically the output of `read_cv_sheet` or an element
from the list returned by `load_cv_sheets`. Must not be `NULL`.}

\item{typst_func}{The name of the Typst function to call for each entry
(row). Must be a single string starting with `#`, e.g., `"#cvEntry"`.}

\item{combine_cols}{Optional: A vector of column names or a tidyselect
expression (e.g., `c(detail_1, detail_2)` or `starts_with("detail")`)
specifying columns to combine into a single field. Defaults to `NULL`
(no combination).}

\item{combine_as}{Character string: The name of the new field in the Typst
dictionary that will contain the combined values. Defaults to `"details"`.
Must be a single, non-empty string.}

\item{combine_sep}{Character string: The separator used when joining the
values from `combine_cols`. Defaults to `"\\n"` (newline). Can be empty.}

\item{combine_prefix}{Character string: A prefix added to each non-NA value
before joining. Defaults to `"- "`. Can be empty.}

\item{exclude_cols}{Optional: A vector of column names or a tidyselect
expression specifying columns to exclude from the Typst output.
Defaults to `NULL` (no exclusion). Columns listed in `combine_cols`
are automatically excluded from the main output dictionary.}

\item{na_action}{Character string: How to handle `NA` values in columns *not*
involved in `combine_cols`. Must be one of `"omit"`, `"keep"`, or `"string"`.
- `"omit"` (default): Key-value pairs with `NA` values are omitted.
- `"keep"`: `NA` values are converted to Typst's `none` literal.
- `"string"`: `NA` values are converted to the string `"NA"`.}
}
\value{
A single character string containing Typst code. This string consists
        of multiple Typst function calls (one per row of `data`), wrapped
        in a ```{typst} ... ``` block. Returns an empty Typst block
        `"```{typst}\n```"` if the input data frame has zero rows after
        validation. Throws an error if arguments are invalid.
}
\description{
Takes a data frame (tibble) representing a CV section and formats it into
a single string suitable for Typst. Each row of the data frame is converted
into a Typst function call. Columns can be combined or excluded using
tidyselect syntax. Argument validation is performed using assertions from
the `checkmate` package via an internal helper function.
}
\examples{
\dontrun{
# --- Setup: Create example data ---
example_data <- dplyr::tibble(
  Date = c("2023-01-01", "2022-05-15", "2021-11-30"),
  Title = c("Project Alpha", "Research Grant", "Initial Concept"),
  Location = c("Lab A", "University X", "Office B"),
  Description = c("Developed core module.", "Secured funding.", "Drafted proposal."),
  Detail_A = c("Used R and Python", "Wrote application", "Market research"),
  Detail_B = c("Met all deadlines", NA, "Competitor analysis"),
  Status = c("Completed", "Ongoing", "Completed"),
  Notes = c("Successful deployment", "Reporting due Q4", NA)
)

# Load the package if not already loaded
# library(academicCVtools)
# Or use devtools::load_all() during development

# --- Example 1: Basic usage ---
# All columns used, NA omitted (default)
cat(format_typst_section(example_data, typst_func = "#basicEntry"))

# --- Example 2: Combining detail columns ---
# Combine Detail_A and Detail_B into "key_points"
cat(format_typst_section(
  data = example_data,
  typst_func = "#projectEntry",
  combine_cols = c(Detail_A, Detail_B), # Tidyselect: Explicit names
  combine_as = "key_points",
  combine_prefix = "* "
))

# --- Example 3: Combining with starts_with ---
# Combine all columns starting with "Detail_"
cat(format_typst_section(
  data = example_data,
  typst_func = "#projectEntry",
  combine_cols = starts_with("Detail_"), # Tidyselect: Helper function
  combine_as = "details_combined",
  combine_prefix = "- "
))

# --- Example 4: Excluding columns ---
# Exclude 'Status' and 'Notes'
cat(format_typst_section(
  data = example_data,
  typst_func = "#simpleEntry",
  exclude_cols = c(Status, Notes) # Tidyselect: Explicit names
))

# --- Example 5: Combining AND Excluding ---
# Combine details, exclude Location, Status, and Notes
cat(format_typst_section(
  data = example_data,
  typst_func = "#focusedEntry",
  combine_cols = starts_with("Detail_"),
  combine_as = "key_details",
  exclude_cols = c(Location, Status, Notes)
))

# --- Example 6: Handling NA as 'none' ---
cat(format_typst_section(
  data = example_data,
  typst_func = "#entryWithNone",
  na_action = "keep"
))

# --- Example 7: Handling NA as string "NA" ---
cat(format_typst_section(
  data = example_data,
  typst_func = "#entryWithStringNA",
  na_action = "string"
))

# --- Example 8: Empty Input Data ---
# Should return empty Typst block without warning (checked in validator)
cat(format_typst_section(
  data = example_data[0, ], # Empty data frame
  typst_func = "#emptyEntry"
))

# --- Example 9: Invalid Tidyselect (should error via helper) ---
tryCatch(
  format_typst_section(
    data = example_data,
    typst_func = "#errorEntry",
    exclude_cols = c(Status, NonExistentCol)
  ),
  error = function(e) print(paste("Successfully caught expected error:", e$message))
)

# --- Example 10: Invalid Argument (should error via checkmate) ---
tryCatch(
  format_typst_section(
    data = example_data,
    typst_func = "NotStartingWithHash" # Invalid typst_func
  ),
  error = function(e) print(paste("Successfully caught expected error:", e$message))
)
}
}
